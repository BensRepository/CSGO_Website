<!DOCTYPE html>
<html lang="en">
     
{% load static %}

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>CS:GO Tools Case Calculator</title>
        <!-- tab bar icon-->
        <link rel="icon" type="image/x-icon" href="{% static 'cases/Chroma_2.png'%}" />
        <!-- Bootstrap icons-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet" />
        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="{% static 'css/styles.css'%}" rel="stylesheet" />
        <link href="{% static 'css/calculator.css'%}" rel="stylesheet" />
    </head>
    <body  style="background-color: rgb(48, 48, 47);">
        <!-- Responsive navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
            <div class="container px-lg-5">
                <a class="navbar-brand" href="{% url 'index' %}">CS:GO Tools</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link active" aria-current="page" href="{% url 'calculator' %}">Case Calculator</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'sticker' %}">Sticker Search</a></li>
                        <li class="nav-item"><a class="nav-link" href="{% url 'roulette' %}">Strat Roulette</a></li>
                        <li class="nav-item"><a class="nav-link" href="https://steamcommunity.com/tradeoffer/new/?partner=127649164&token=AG79v66Q">DONATE (Trade Link)</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        {{ caseMedianPrices|json_script:"caseMedianPrices" }}
        {{ caseNames|json_script:"caseNames" }}
        {{ Hashid|json_script:"hashids" }}
 
        <script>
            function showInfo(name) {

                document.getElementById("budgetInput").type =  "hidden";
                document.getElementById('caseList').innerHTML=""
                var path = "{% static 'cases/'%}" +name+".png";
                document.getElementById("case").innerHTML =  '<img onclick="removeCase()" src='+path+'>';

                document.getElementById("desc3").innerHTML = "Case Price";
                document.getElementById("price").innerHTML = formatter.format(0) ;

                document.getElementById("desc4").innerHTML = "Key Price" ;
                document.getElementById("keyprice").innerHTML = formatter.format(0);
                

                document.getElementById("title").innerHTML = "Choose Amount";
                document.getElementById("desc2").innerHTML = "Number of cases";
                document.getElementById("desc").innerHTML = name.split('_').join(' ') + " Case";
                document.getElementById("desc5").innerHTML = "Total Cost";
                document.getElementById("total").innerHTML = formatter.format(0);
                if(document.getElementById("input").innerHTML ==""){
                    document.getElementById("input").innerHTML = '<input id="ValueField" type="number" min="0" onchange="onChange();" onkeyup="calculatetotal()"/>';
                    
                }
                document.getElementById("buy").innerHTML ='';
                document.getElementById("simulate").innerHTML ='';
                document.getElementById("blues").innerHTML = "";
                document.getElementById("purples").innerHTML = "";
                document.getElementById("pinks").innerHTML = "";
                document.getElementById("reds").innerHTML = "";
                document.getElementById("yellows").innerHTML = "";
                document.getElementById("simulatorTitle").innerHTML = "";
                var casePrices = JSON.parse(document.getElementById('caseMedianPrices').textContent);

                if((document.getElementById("budgetInput").value !="£1,000,000.00")&& document.getElementById("input")!= ""){
                    caseAndKeyPrice = casePrices[name] + 1.99;
                    caseAmount = document.getElementById("budgetInput").value/caseAndKeyPrice;
                    document.getElementById("ValueField").value = Math.trunc(caseAmount);
                    calculatetotal();
               } 
                
              
               calculatetotal();
               
                }
            function onChange(){
                clearBudget()
                calculatetotal()
            }
            function clearBudget(){
                document.getElementById("budgetInput").value = "£1,000,000.00"
            }
            
            function removeCase(){

             
                document.getElementById("case").innerHTML =  "";

                document.getElementById("desc3").innerHTML = "";
                document.getElementById("price").innerHTML = "";

                document.getElementById("desc4").innerHTML = "";
                document.getElementById("keyprice").innerHTML = "";
                

                document.getElementById("title").innerHTML = "Budget Case Calculator";
                document.getElementById("budgetInput").type='number';
                document.getElementById("desc").innerHTML = "Enter budget";
                document.getElementById("desc2").innerHTML = "";
    
         
                document.getElementById("desc5").innerHTML = "";
                document.getElementById("total").innerHTML = "";
                document.getElementById("input").innerHTML = "";
                document.getElementById("buy").innerHTML ="";
                document.getElementById("simulate").innerHTML ="";
                document.getElementById("blues").innerHTML = "";
                document.getElementById("purples").innerHTML = "";
                document.getElementById("pinks").innerHTML = "";
                document.getElementById("reds").innerHTML = "";
                document.getElementById("yellows").innerHTML = "";
                document.getElementById("simulatorTitle").innerHTML = "";
                calculateBudget()
            }
            
            function calculateBudget(){
       
                var budget = document.getElementById("budgetInput").value;
                var casePrices = JSON.parse(document.getElementById('caseMedianPrices').textContent) ;
                var caseNames = JSON.parse(document.getElementById('caseNames').textContent);
                document.getElementById('caseList').innerHTML=""
                for (let i = 0; i < caseNames.length; i++) {
                    caseAndKeyPrice = casePrices[caseNames[i]] + 1.99
                    caseAmount = budget/caseAndKeyPrice
                    if(caseAmount > 1){
                        makeImages(caseNames[i],caseAmount);
                    }
                   
                    ///document.getElementById('caseImages').appendChild(casePrices[casesNames[i]]);
                }

            }



            function makeImages(caseName,caseAmount){
                var img = document.createElement("IMG");
                url = "/static/cases/"+caseName+".png"
                img.src = url;
                img.id = caseName;
                img.style.width = "100px";
                img.style.height = "auto"; 
                img.addEventListener("click", function(){showInfo(caseName) });;

                let p = document.createElement('p');
                p.id = caseName +"p"
                p.style.display="inline-block"
                document.getElementById("caseList").appendChild(p);
                document.getElementById(caseName +"p").appendChild(img);
                
                let p2 = document.createElement('p');
                p2.id = caseName +"p2"
                p2.style.display="inline-block"
                document.getElementById("caseList").appendChild(p);
                p2.innerHTML="x "+String(Math.trunc(caseAmount));
                document.getElementById(caseName +"p").appendChild(p2)
                //document.getElementById(div.id).appendChild(p);
                
            }
        </script>
        <!-- Page Content-->
        <section>
            <div class="container">
                <div class="left">
                    <h1> Specific Case Calculator</h1>
                    <h4>Select Case</h4>
                    
                    {% for key,value in caseMedianPrices.items %}
                    
                        <img id="{{key}}"src=""onclick="showInfo('{{key}}')" alt="{{key}}">
                        £{{value}}
                        
                    <script>
                        var path = "{% static 'cases/'%}" +"{{key}}"+".png";
                        document.getElementById("{{key}}").src=path;
                    </script>
                        {% endfor %}
                </div>
                
                <div class="right">
                    <div style="display: inline-block;">
                        <h1 id="title">Budget Case Calculator</h1>
                        <h4 id="desc">Enter budget</h4>
                        <input style="display: block;"id="budgetInput"step="any" placeholder ="£1,000,000.00"type="number" min="0" onchange="calculateBudget()" onkeyup="calculateBudget()"/>
                        
                        <div style=" display: inline-block; padding: 0px; "id="caseList"></div >
                        <p id="case"></p>

                        <h5 id="desc2"></h5>
                        <p id="input"></p>
                        
                        <h6 id="desc3"></h6>
                        <p id="price"></p>
                        <h6 id="desc4"></h6>
                        <p id="keyprice"></p>
        
                        <h6 id="desc5"></h6>
                        <p id="total"></p>

                        <div style="width: 75px; float:left; height:50px;  margin:5px">
                            <p id="buy"></p>
                        </div>
                        <div style="width: 75px; float:left; height:50px;  margin:5px">
                            <p id="simulate"></p>
                        </div>
                    </div>

                    <div style="width: 150px; display: inline-block;">
                        <div >
                            <h5 id="simulatorTitle"></h5>
                            <p id="blues"></p>
                            <p id="purples"></p>
                            <p id="pinks"></p>
                        </div>
                        <div>
                            <p id="reds"></p>
                            <p id="yellows"></p>
                        </div>
                    </div>
                </div>
        </section>
        
        <!-- Footer-->
        <div style="height: 26px;background-color:  rgba(27, 27, 27, 0.9);;position: fixed;text-align: center;bottom: 0px;width: 101%; "><p class="m-0 text-center text-white">Copyright &copy; CS:GO Tools 2023</p></div>
        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="{% static 'js/calculatorscript.js' %}"></script>
    </body>
</html>